{% extends "SiteLayout" %}

{% block "titleheader" %}
{{Resources.RuntimeModelResources.RuntimeModelAuthenticationListView_TitleHeader | Escape }}
{% endblock %}

{% block "sidebar" %}
<link rel="stylesheet" href="runtime/assets/css/simple-sidebar.css">
<div id="sidebar-wrapper">
    <div class="vertical-centered">
        <div class="nav-box">
		{% comment %}
		  Add language chooser at top of "nav-box" element		  
		{% endcomment %}
        <span class="d-none" id="resource-language"> {{ Resources.GlobalTextResources.TextResourcesLanguage }} </span>
            <form role="form" method="post" class="language-chooser" action="">
                {{ Csrf }}
                <input type="hidden" id="selectedLanguage" name="selectedLanguage" value="" />
                <div class="language-toggle">
                    <button type="button" class="primary-button" onclick="toggleMenu()" id="selectedLangBtn" aria-haspopup="true" aria-expanded="false" aria-controls="languageMenu">
                        <div class="selected-lang">
                            <span id="selected-lang-icon">
                                <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="globe" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="svg-inline--fa fa-globe fa-w-16"><path fill="currentColor" d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z" class=""></path></svg>
                            </span>
                            <span id="selected-lang-text">Language</span>
                        </div>
                        <span class="language-arrow"></span>
                    </button>
            
                    <div id="languageMenu" class="language-menu">
                    
                        <button type="button" onclick="chooseLanguage()" data-lang="da">
                            <div class="country-option">
                                <span class="flag-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><rect x="1" y="4" width="30" height="24" rx="4" ry="4" fill="#b92932"></rect><path fill="#fff" d="M31 14L15 14 15 4 11 4 11 14 1 14 1 18 11 18 11 28 15 28 15 18 31 18 31 14z"></path><path d="M27,4H5c-2.209,0-4,1.791-4,4V24c0,2.209,1.791,4,4,4H27c2.209,0,4-1.791,4-4V8c0-2.209-1.791-4-4-4Zm3,20c0,1.654-1.346,3-3,3H5c-1.654,0-3-1.346-3-3V8c0-1.654,1.346-3,3-3H27c1.654,0,3,1.346,3,3V24Z" opacity=".15"></path><path d="M27,5H5c-1.657,0-3,1.343-3,3v1c0-1.657,1.343-3,3-3H27c1.657,0,3,1.343,3,3v-1c0-1.657-1.343-3-3-3Z" fill="#fff" opacity=".2"></path></svg>
                                </span>
                                <span class="language">
                                    Dansk
                                </span>
                            </div>
                            <svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" fill="currentColor"
                                class="bi bi-check-lg check d-none" viewBox="0 0 16 16">
                                <path
                                    d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z" />
                            </svg>
                        </button>
            
                        <button type="button" onclick="chooseLanguage()" data-lang="en">
                            <div class="country-option">
                                <span class="flag-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><rect x="1" y="4" width="30" height="24" rx="4" ry="4" fill="#fff"></rect><path fill="#be2a2a" d="M31 14L18 14 18 4 14 4 14 14 1 14 1 18 14 18 14 28 18 28 18 18 31 18 31 14z"></path><path d="M27,4H5c-2.209,0-4,1.791-4,4V24c0,2.209,1.791,4,4,4H27c2.209,0,4-1.791,4-4V8c0-2.209-1.791-4-4-4Zm3,20c0,1.654-1.346,3-3,3H5c-1.654,0-3-1.346-3-3V8c0-1.654,1.346-3,3-3H27c1.654,0,3,1.346,3,3V24Z" opacity=".15"></path><path d="M27,5H5c-1.657,0-3,1.343-3,3v1c0-1.657,1.343-3,3-3H27c1.657,0,3,1.343,3,3v-1c0-1.657-1.343-3-3-3Z" fill="#fff" opacity=".2"></path></svg>
                                </span>
                                <span class="language">
                                    English
                                </span>
                            </div>
                            <svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" fill="currentColor"
                                class="bi bi-check-lg check d-none" viewBox="0 0 16 16">
                                <path
                                    d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z" />
                            </svg>
                        </button>
            
                        <button type="button" onclick="chooseLanguage()" data-lang="de">
                            <div class="country-option">
                                <span class="flag-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><path fill="#cc2b1d" d="M1 11H31V21H1z"></path><path d="M5,4H27c2.208,0,4,1.792,4,4v4H1v-4c0-2.208,1.792-4,4-4Z"></path><path d="M5,20H27c2.208,0,4,1.792,4,4v4H1v-4c0-2.208,1.792-4,4-4Z" transform="rotate(180 16 24)" fill="#f8d147"></path><path d="M27,4H5c-2.209,0-4,1.791-4,4V24c0,2.209,1.791,4,4,4H27c2.209,0,4-1.791,4-4V8c0-2.209-1.791-4-4-4Zm3,20c0,1.654-1.346,3-3,3H5c-1.654,0-3-1.346-3-3V8c0-1.654,1.346-3,3-3H27c1.654,0,3,1.346,3,3V24Z" opacity=".15"></path><path d="M27,5H5c-1.657,0-3,1.343-3,3v1c0-1.657,1.343-3,3-3H27c1.657,0,3,1.343,3,3v-1c0-1.657-1.343-3-3-3Z" fill="#fff" opacity=".2"></path></svg>
                                </span>
                                <span class="language">
                                    Deutsch
                                </span>
                            </div>
                            <svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" fill="currentColor"
                                class="bi bi-check-lg check d-none" viewBox="0 0 16 16">
                                <path
                                    d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022Z" />
                            </svg>
                        </button>
                    </div>
                </div>
            </form>
            <p class="form-bottom nav-bottom">
            <p>
                <img src="runtime/assets/img/safewhere_logo.png" alt="Safewhere" />
            </p>
            <form role="form" method="post" class="login-form">

                <div class="text-center form-group">
                    <strong>
                        <span class="text-info">{{ Model.Message  | Escape }}</span>
                    </strong>
                </div>

                {% for l in Model.AuthenticationLinks %}
                <div class="center-block inner-list">
                    <a role="button" class="text-center btn btn-link-2 btn-blue arrow" onclick="doContinue('{{ l.Url | Escape }}')" href="javascript:void(0)">{{ l.Text | Escape }}</a>
                    {% if l.HelpText != "" %}
                    <div class="text-justify help-text inner-list">{{ l.HelpText  | Escape }}</div>
                    {% endif %}
                </div>
                {% endfor %}
                
    			{% if Model.OfferRememberUserChoiceOfIdentityProvider == true %}
    			<input id="cbRememberIdP" name="Remember" type="checkbox" style="margin: 3px 3px 3px 4px;" /> {{Model.OfferRememberUserChoiceOfIdentityProviderHelpText}}
    			<br />
    			{% endif %}
    			
                <script type="text/javascript">
                    function doContinue(url) {
                        {% if Model.OfferRememberUserChoiceOfIdentityProvider == true %}
                            window.location.href = url + '&remember=' + $('#cbRememberIdP').is(':checked');
                        {% else %}
                            window.location.href = url + '&remember=unspecified';
                        {% endif %}
                    }
                </script>

            </form>
            {% if Model.UserNamePasswordActionLink != "" %}
            <div class="text-center form-group">
                <strong>
                    <span class="text-info"> {{Resources.RuntimeModelResources.AuthenticationList_Or | Escape }} </span>
                </strong>
            </div>

            <form role="form" method="post" class="login-form" action="{{ Model.UserNamePasswordActionLink  | Escape }}">

                {{ Csrf }}

                <div class="form-group">
                    <label class="sr-only" for="form-username">{{Resources.RuntimeModelResources.AuthenticationList_UserNamePasswordUsernameLabel | Escape }}</label>
                    <input type="text" name="name" placeholder="{{Resources.RuntimeModelResources.AuthenticationList_UserNamePasswordUsernameLabel | Escape }}" value="" class="form-username form-control required" id="form-username">
                </div>
                <div class="form-group">
                    <label class="sr-only" for="form-password">{{Resources.RuntimeModelResources.AuthenticationList_UserNamePasswordPasswordLabel | Escape }}</label>
                    <input type="password" name="password" placeholder="{{Resources.RuntimeModelResources.AuthenticationList_UserNamePasswordPasswordLabel | Escape }}" class="form-password form-control required" id="form-password">
                </div>
                <div class="form-group">
                    <button type="submit" class="btn" style="width: 100%">{{Resources.RuntimeModelResources.AuthenticationList_Ok | Escape }}</button>
                </div>
                <div class="text-center">
                    <span class="text-danger">
                        <a href="{{ Model.ForgotPasswordLink  | Escape }}">{{Resources.RuntimeModelResources.UserNamePasswordForgotPasswordClickHereLabel | Escape }}</a>
                    </span>
                </div>
            </form>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block "content" %}
<div class="form-box">
    <link rel="stylesheet" href="runtime/assets/css/full-sidebar.css">
</div>
<style>

{% comment %}
  Style to display the language selection dropbox at right-top coner
{% endcomment %}
.language-toggle {
        position: absolute;
        display: block;
        top: 25px;
        right: 25px;
        font-size: 1rem;
    }

    .language-menu {
        display: none;
        position: absolute;
        top: 115%;
        left: 0;
        background-color: white;
        border: 1px solid #ccc;
        min-width: 200px;
        z-index: 1000;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border-radius: 12px;
        padding: 10px 0;
    }

    .language-menu button {
        width: 100%;
        padding: 10px 12px;
        border: none;
        background: none;
        text-align: left;
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        justify-content: space-between;
    }

    .language-menu button:hover {
        background-color: #f0f0f0;
    }

    .language-menu button .country-option {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .primary-button {
        padding: 10px 15px;
        background-color: #fff;
        color: #313c3f;
        border: 1px solid #ccc;
        border-radius: 12px;
        cursor: pointer;
        display: flex;
        align-items: center;
        width: 170px;
        height: 30px;
        justify-content: space-between;
    }

    .primary-button .selected-lang {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    #selected-lang-icon,
    .flag-icon {
        width: 20px;
        height: 20px;
    }

    #selected-lang-icon svg,
    .flag-icon svg {
        width: 100%;
        height: 100%;
        display: flex;
    }
    
    #selected-lang-text {
        max-width: 90px;
        text-align: left;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 1;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .language {
        max-width: 120px;
        text-align: left;
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 1;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .language-arrow {
        position: relative;
        bottom: 2px;
        height: 8px;
        width: 8px;
        border-left-width: 2px;
        border-top-width: 2px;
        border-top: 1px solid;
        border-right: 1px solid;
        content: "";
        transform: rotate(135deg);
        transition: transform 0.3s ease;
    }
</style>
{% comment %}
  Script to handle the language selection (added at the bottom of 'content' section)
{% endcomment %}
<script>
    const defaultLanguageCode = "en";
    const languages = {
        "en": "English",
        "da": "Dansk",
        "de": "Deutsch"
    }
    
    function chooseLanguage() {
        const $button = $(event.currentTarget);
        const lang = $button.data('lang');
        const selectedIcon = $button.find('.flag-icon').html();
        const selectedLang = $button.find('.language').text();

        $('#selectedLanguage').val(lang);
        updateLanguageUI(selectedLang, selectedIcon);
        $('#languageMenu').hide();

        showCheckMark($button);

        submitLanguage();
    }

    function toggleMenu() {
        $('#languageMenu').toggle();
    }
    
    function updateLanguageUI(lang, iconHTML) {
        $('#selected-lang-icon').html(iconHTML);
        $('#selected-lang-text').text(lang || "Language");
    }
    
    function hideAllCheckMarks() {
        $('#languageMenu button .check').removeClass('d-block').addClass('d-none');
    }
    
    function showCheckMark($button) {
        hideAllCheckMarks();
        const $checkIcon = $button.find('.check');
        if ($checkIcon.length) {
            $checkIcon.addClass('d-block').removeClass('d-none');
        }
    }
    
    function submitLanguage() {
        const $loginForm = $('.login-form');
        const $languageForm = $('.language-chooser');

        if (!$loginForm.length || !$languageForm.length) return;

        let ici_ci = null;
        $loginForm.find('a[onclick]').each(function () {
            const onclickValue = $(this).attr('onclick');
            const match = onclickValue.match(/ici_ci=([^&']+)/);
            if (match) {
                ici_ci = match[1];
                return false; // break
            }
        });

        if (!ici_ci) {
            console.error('ici_ci not found in login-form.');
            return;
        }

        const newActionUrl = 'runtime/LanguageChooser/Index2?ici_ci=' + encodeURIComponent(ici_ci);
        $languageForm.attr('action', newActionUrl).submit();
    }


    // On page load, apply saved language
    $(window).on('load', function () {
        const resourceLanguage = $('#resource-language').text().trim();
        const matchingKey = Object.keys(languages).find(key => languages[key] === resourceLanguage);
        const savedLang = matchingKey || defaultLanguageCode;

        const $buttons = $('#languageMenu button');
        let selectedIcon = '<svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="globe" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="svg-inline--fa fa-globe fa-w-16"><path fill="currentColor" d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z" class=""></path></svg>';
        let selectedLang = 'Language';

        $buttons.each(function () {
            const $button = $(this);
            if ($button.data('lang') === savedLang) {
                selectedIcon = $button.find('.flag-icon').html();
                selectedLang = $button.find('.language').text();
                showCheckMark($button);
            }
        });

        updateLanguageUI(selectedLang, selectedIcon);
    });
    
    $(window).on('click', function (event) {
        const $menu = $('#languageMenu');
        const $button = $('.primary-button');

        if (!$button.is(event.target) && !$menu.is(event.target) && 
            $menu.has(event.target).length === 0 && $button.has(event.target).length === 0) {
            $menu.hide();
        }
    });
</script>
{% endblock %}